# Changelog WatchApps

Все значимые изменения в проекте документируются в этом файле.

## [2025-12-03] - Реализация верификации email и улучшения профиля разработчика

### Добавлено

#### Верификация email
- **Полная система верификации email**:
  - Автоматическая отправка письма при регистрации
  - Ручная отправка письма через `/auth/send-verification`
  - Подтверждение email через ссылку в письме (`/verify-email?token=...`)
  - Страница подтверждения email с обработкой успеха/ошибок
  - Автоматический редирект после подтверждения
  - Сброс верификации при изменении email

- **Настройка почтового сервера**:
  - Конфигурация SMTP через Reg.ru
  - Настройка DNS записей (SPF, MX, DMARC, DKIM)
  - Использование `noreply@watchapps.ru` для отправки писем
  - Поддержка TLS шифрования (порт 587)

- **Email шаблоны**:
  - Красивый HTML шаблон письма подтверждения
  - Кнопка подтверждения с токеном
  - Информация о сроке действия токена (24 часа)

#### Профиль разработчика
- **Редактирование профиля** (`/dev/onboarding`):
  - Поле email с возможностью изменения
  - Валидация email с отображением ошибок на русском языке
  - Индикатор статуса подтверждения email:
    - ✅ Зеленая галочка - email подтвержден
    - ⚠️ Желтый восклицательный знак - email не подтвержден
  - Загрузка и отображение логотипа бренда
  - Кнопка "На главную" для быстрого возврата на dashboard
  - Автоматическое обновление данных после подтверждения email

- **Улучшения UX**:
  - Сообщение о необходимости подтверждения email при изменении
  - Предупреждение о сбросе верификации при смене email
  - Автоматическое обновление индикатора статуса после подтверждения

#### Безопасность и авторизация
- **Проверка авторизации на страницах входа/регистрации**:
  - Автоматический редирект авторизованных пользователей
  - Разработчики перенаправляются на `/dev/dashboard` или `/dev/onboarding`
  - Обычные пользователи перенаправляются на `/`
  - Индикатор загрузки во время проверки авторизации

- **Middleware**:
  - Разрешен доступ к `/verify-email` без авторизации
  - Разрешен доступ к `/verify` для верификации
  - Защита всех остальных маршрутов `/dev/*`

#### Стилизация
- **Glassmorphism дизайн**:
  - Применен стиль "жидкое стекло" ко всему сайту
  - Полупрозрачные фоны с размытием (backdrop-blur)
  - Градиентные фоны и тени
  - Анимированные декоративные элементы (blobs)
  - Адаптивность для темной и светлой темы

### Изменено

- **Модель EmailVerificationToken**:
  - Добавлена поддержка `created_at` с автоматической установкой
  - Исправлена проверка истечения токена (24 часа)
  - Корректная обработка строковых дат

- **DeveloperOnboardingController**:
  - Добавлена валидация email с русскими сообщениями об ошибках
  - Автоматический сброс `email_verified_at` при изменении email
  - Удаление старых токенов при смене email
  - Возврат статуса `email_verified` в ответе API

- **AuthController**:
  - Метод `verifyEmail` для подтверждения email по токену
  - Метод `sendVerification` для отправки письма подтверждения
  - Автоматическая отправка письма при регистрации
  - Улучшенная обработка ошибок с русскими сообщениями

- **Frontend страницы**:
  - `/dev/onboarding` - добавлено поле email, индикатор статуса, кнопка "На главную"
  - `/verify-email` - полная страница подтверждения с обработкой всех состояний
  - `/dev/login` и `/dev/register` - проверка авторизации с редиректом
  - `/login` и `/register` - проверка авторизации с редиректом

### Исправлено

- **Проблемы с отображением логотипа**:
  - Исправлена загрузка и отображение логотипа после сохранения
  - Корректное обновление preview при загрузке нового файла
  - Обновление логотипа в Header после изменения

- **Проблемы с верификацией email**:
  - Исправлен редирект на страницу входа после подтверждения
  - Добавлена полная перезагрузка страницы для обновления состояния
  - Исправлена обработка токенов с NULL `created_at`
  - Исправлен middleware для разрешения доступа к `/verify-email`

- **Проблемы с валидацией**:
  - Отображение ошибок валидации на русском языке
  - Корректная обработка ошибок 422 от API
  - Очистка ошибок при изменении полей формы

- **Проблемы с авторизацией**:
  - Исправлен редирект авторизованных пользователей со страниц входа/регистрации
  - Корректная проверка ролей при редиректе

### Технические детали

#### Backend
- **Новые модели**: `EmailVerificationToken`
- **Новые контроллеры**: Методы в `AuthController` для верификации
- **Новые миграции**: `create_email_verification_tokens_table`
- **Новые Mailables**: `VerifyEmail` для отправки писем
- **Новые middleware**: `SetLocale` для установки русской локали

#### Frontend
- **Новые страницы**: `/verify-email` для подтверждения email
- **Обновленные компоненты**: Header, Footer, Layout с glassmorphism стилями
- **Обновленные утилиты**: `apiFetch` с улучшенной обработкой ошибок 422
- **Новые события**: `userDataUpdated` для синхронизации данных пользователя

#### Конфигурация
- **Nginx**: Добавлен location для `/storage/` для статических файлов
- **Laravel .env**: Настройки SMTP для отправки писем
- **DNS**: Настроены SPF, MX, DMARC записи для домена watchapps.ru

---

## [Ранее] - Базовые функции

### Реализовано
- Регистрация и авторизация пользователей и разработчиков
- Dev Console с dashboard
- Управление циферблатами (CRUD)
- Статистика циферблатов
- Загрузка файлов (логотипы, APK, скриншоты)
- Публичный каталог циферблатов
- Система ролей (user, developer, admin)

---

**Формат основан на [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/)**


