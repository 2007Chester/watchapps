# üìß –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ email

**–î–∞—Ç–∞**: $(date +"%Y-%m-%d %H:%M:%S")

---

## ‚úÖ –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### Backend:
1. ‚úÖ Mailable –∫–ª–∞—Å—Å `VerifyEmail` —Å–æ–∑–¥–∞–Ω
2. ‚úÖ –®–∞–±–ª–æ–Ω –ø–∏—Å—å–º–∞ `verify-email.blade.php` —Å–æ–∑–¥–∞–Ω
3. ‚úÖ –ú–µ—Ç–æ–¥ `sendVerification()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
4. ‚úÖ –ú–µ—Ç–æ–¥ `verifyEmail()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
5. ‚úÖ –†–æ—É—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã:
   - `POST /api/auth/send-verification` - –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–∏—Å—å–º–∞
   - `GET /api/auth/verify/{token}` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email
6. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
7. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ email
8. ‚úÖ Postfix —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω

### Frontend:
1. ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/verify-email` –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
2. ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/verify/send` –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
3. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π (—É—Å–ø–µ—Ö, –æ—à–∏–±–∫–∞, –∏—Å—Ç–µ–∫, —É–∂–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω)

### DNS:
1. ‚úÖ SPF –∑–∞–ø–∏—Å—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
2. ‚úÖ A –∑–∞–ø–∏—Å—å –¥–ª—è mail –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
3. ‚úÖ DMARC –Ω–∞—Å—Ç—Ä–æ–µ–Ω

---

## ‚ö†Ô∏è –¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞

**–ü–æ—Ä—Ç 25 –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º**, –ø–æ—ç—Ç–æ–º—É –ø–∏—Å—å–º–∞ –Ω–µ –¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ Postfix.

**–û—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö**:
- `connect to mxs.mail.ru[217.69.139.150]:25: Connection timed out`
- `connect to mx2.hosting.reg.ru[31.31.194.241]:25: Connection timed out`

**–í –æ—á–µ—Ä–µ–¥–∏**: –ï—Å—Ç—å –ø–∏—Å—å–º–∞, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã

---

## üéØ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

### 1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SMTP Relay (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

–ü–æ—Å–∫–æ–ª—å–∫—É –ø–æ—Ä—Ç 25 –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–π SMTP —Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏.

#### –í–∞—Ä–∏–∞–Ω—Ç A: SMTP —Ö–æ—Å—Ç–∏–Ω–≥–∞ (reg.ru)

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –ø–æ—á—Ç–æ–≤—ã–π —è—â–∏–∫ –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥–µ:

1. **–û–±–Ω–æ–≤–∏—Ç–µ `.env` —Ñ–∞–π–ª**:
```env
MAIL_MAILER=smtp
MAIL_HOST=smtp.hosting.reg.ru
MAIL_PORT=587
MAIL_USERNAME=noreply@watchapps.ru
MAIL_PASSWORD=your-password
MAIL_ENCRYPTION=tls
MAIL_FROM_ADDRESS=noreply@watchapps.ru
MAIL_FROM_NAME="WatchApps"
```

2. **–û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à**:
```bash
cd /var/www/watchapps/backend
php artisan config:clear
php artisan cache:clear
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å

**Mailgun** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
```env
MAIL_MAILER=mailgun
MAILGUN_DOMAIN=watchapps.ru
MAILGUN_SECRET=your-mailgun-secret
MAILGUN_ENDPOINT=api.mailgun.net
MAIL_FROM_ADDRESS=noreply@watchapps.ru
MAIL_FROM_NAME="WatchApps"
```

**Postmark**:
```env
MAIL_MAILER=postmark
POSTMARK_API_KEY=your-postmark-api-key
MAIL_FROM_ADDRESS=noreply@watchapps.ru
MAIL_FROM_NAME="WatchApps"
```

**AWS SES**:
```env
MAIL_MAILER=ses
AWS_ACCESS_KEY_ID=your-access-key
AWS_SECRET_ACCESS_KEY=your-secret-key
AWS_DEFAULT_REGION=us-east-1
MAIL_FROM_ADDRESS=noreply@watchapps.ru
MAIL_FROM_NAME="WatchApps"
```

### 2. –û—á–∏—Å—Ç–∏—Ç—å –æ—á–µ—Ä–µ–¥—å Postfix

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SMTP, –æ—á–∏—Å—Ç–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –ø–∏—Å—å–º–∞ –∏–∑ –æ—á–µ—Ä–µ–¥–∏:

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—á–µ—Ä–µ–¥–∏
postqueue -p

# –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ–π –æ—á–µ—Ä–µ–¥–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
postsuper -d ALL
```

### 3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É

```bash
cd /var/www/watchapps/backend
php artisan tinker
```

–í tinker:
```php
use Illuminate\Support\Facades\Mail;
use App\Mail\VerifyEmail;
use App\Models\User;

$user = User::first();
$token = 'test-token-' . time();
$url = 'https://watchapps.ru/verify-email?token=' . $token;

Mail::to($user->email)->send(new VerifyEmail($user, $url));
```

### 4. –î–æ–±–∞–≤–∏—Ç—å UI –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏—Å—å–º–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ –µ—â–µ –Ω–µ—Ç, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è" –Ω–∞:
- –°—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–æ—Ñ–∏–ª—è
- –î–∞—à–±–æ—Ä–¥ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
- –ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

### 5. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏—Å–µ–º:
- –£—Å–ø–µ—à–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
- –û—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π

---

## üìã –ß–µ–∫-–ª–∏—Å—Ç –¥–µ–π—Å—Ç–≤–∏–π

- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SMTP Relay (–≤—ã–±—Ä–∞—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç A –∏–ª–∏ B)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `.env` —Ñ–∞–π–ª —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ SMTP
- [ ] –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à Laravel (`php artisan config:clear`)
- [ ] –û—á–∏—Å—Ç–∏—Ç—å –æ—á–µ—Ä–µ–¥—å Postfix (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –ø–∏—Å—å–º–∞
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–∏—Å—å–º–∞ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π email
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email –ø–æ —Å—Å—ã–ª–∫–µ
- [ ] (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –î–æ–±–∞–≤–∏—Ç—å UI –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏—Å—å–º–∞
- [ ] (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

---

## üîß –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ SMTP —Ö–æ—Å—Ç–∏–Ω–≥–∞:

```bash
cd /var/www/watchapps/backend

# –î–æ–±–∞–≤—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ .env (–æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª)
# –ó–∞—Ç–µ–º:
php artisan config:clear
php artisan cache:clear

# –û—á–∏—Å—Ç–∏—Ç–µ –æ—á–µ—Ä–µ–¥—å Postfix
postsuper -d ALL

# –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ
php artisan tinker
# –í tinker –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é –æ—Ç–ø—Ä–∞–≤–∫—É (—Å–º. –≤—ã—à–µ)
```

### –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Mailgun:

```bash
cd /var/www/watchapps/backend

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–∞–∫–µ—Ç (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
composer require symfony/mailgun-mailer symfony/http-client

# –î–æ–±–∞–≤—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ .env
# –ó–∞—Ç–µ–º:
php artisan config:clear
php artisan cache:clear
```

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–µ–π—Å—Ç–≤–∏–π

1. **–í–´–°–û–ö–ò–ô**: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SMTP Relay (–±–µ–∑ —ç—Ç–æ–≥–æ –ø–∏—Å—å–º–∞ –Ω–µ –±—É–¥—É—Ç –¥–æ—Å—Ç–∞–≤–ª—è—Ç—å—Å—è)
2. **–°–†–ï–î–ù–ò–ô**: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–∏—Å—å–º–∞
3. **–ù–ò–ó–ö–ò–ô**: –î–æ–±–∞–≤–∏—Ç—å UI —É–ª—É—á—à–µ–Ω–∏—è –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SMTP, Postfix –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ (Laravel –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ SMTP)
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ SMTP —Å–µ—Ä–≤–µ—Ä –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å –¥–æ–º–µ–Ω–∞ `watchapps.ru`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ SPF –∑–∞–ø–∏—Å—å —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É —Å –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ SMTP —Å–µ—Ä–≤–µ—Ä–∞

